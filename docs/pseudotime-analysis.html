<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>23 Pseudotime analysis | SCpubr</title>
<meta name="author" content="Enrique Blanco Carmona">
<meta name="description" content="Due to a discontinuation of Matrix.utils package, monocle3 can not be installed and tested in a CI manner. Until this is resolved, this function will not be available in any official and...">
<meta name="generator" content="bookdown 0.28 with bs4_book()">
<meta property="og:title" content="23 Pseudotime analysis | SCpubr">
<meta property="og:type" content="book">
<meta property="og:url" content="https://enblacar.github.io/SCpubr-book/pseudotime-analysis.html">
<meta property="og:image" content="https://enblacar.github.io/SCpubr-book/images/logo.png">
<meta property="og:description" content="Due to a discontinuation of Matrix.utils package, monocle3 can not be installed and tested in a CI manner. Until this is resolved, this function will not be available in any official and...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="23 Pseudotime analysis | SCpubr">
<meta name="twitter:description" content="Due to a discontinuation of Matrix.utils package, monocle3 can not be installed and tested in a CI manner. Until this is resolved, this function will not be available in any official and...">
<meta name="twitter:image" content="https://enblacar.github.io/SCpubr-book/images/logo.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link rel="shortcut icon" href="images/SCpubr_logo_favicon.png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a id="toc_title" href="index.html" title="">SCpubr</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <div class="book-extra"></div>
      <nav id="left-panel" aria-label="Table of contents"><ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About this package</a></li>
<li><a class="" href="installation-guide.html">Installation guide</a></li>
<li><a class="" href="dataset-used.html">Dataset used</a></li>
<li><a class="" href="dim-plots.html"><span class="header-section-number">1</span> Dim plots</a></li>
<li><a class="" href="feature-plots.html"><span class="header-section-number">2</span> Feature plots</a></li>
<li><a class="" href="nebulosa-plots.html"><span class="header-section-number">3</span> Nebulosa plots</a></li>
<li><a class="" href="bee-swarm-plots.html"><span class="header-section-number">4</span> Bee Swarm plots</a></li>
<li><a class="" href="violin-plots.html"><span class="header-section-number">5</span> Violin plots</a></li>
<li><a class="" href="ridge-plots.html"><span class="header-section-number">6</span> Ridge plots</a></li>
<li><a class="" href="dot-plots.html"><span class="header-section-number">7</span> Dot plots</a></li>
<li><a class="" href="bar-plots.html"><span class="header-section-number">8</span> Bar plots</a></li>
<li><a class="" href="box-plots.html"><span class="header-section-number">9</span> Box plots</a></li>
<li><a class="" href="geyser-plots.html"><span class="header-section-number">10</span> Geyser plots</a></li>
<li><a class="" href="sankey-and-alluvial-plots.html"><span class="header-section-number">11</span> Sankey and alluvial plots</a></li>
<li><a class="" href="chord-diagram-plots.html"><span class="header-section-number">12</span> Chord Diagram plots</a></li>
<li><a class="" href="volcano-plots.html"><span class="header-section-number">13</span> Volcano plots</a></li>
<li><a class="" href="group-wise-de-analysis-plots.html"><span class="header-section-number">14</span> Group-wise DE analysis plots</a></li>
<li><a class="" href="term-enrichment-plots.html"><span class="header-section-number">15</span> Term Enrichment Plots</a></li>
<li><a class="" href="enrichment-score-heatmaps.html"><span class="header-section-number">16</span> Enrichment score heatmaps</a></li>
<li><a class="" href="correlation-matrix-heatmaps.html"><span class="header-section-number">17</span> Correlation matrix heatmaps</a></li>
<li><a class="" href="cellular-state-plots.html"><span class="header-section-number">18</span> Cellular State Plots</a></li>
<li><a class="" href="ligand-receptor-analysis.html"><span class="header-section-number">19</span> Ligand-Receptor analysis</a></li>
<li><a class="" href="copy-number-variant-analysis-plots.html"><span class="header-section-number">20</span> Copy Number Variant analysis plots</a></li>
<li><a class="" href="pathway-activity-inference-analysis.html"><span class="header-section-number">21</span> Pathway Activity inference analysis</a></li>
<li><a class="" href="tf-activity-inference-analysis.html"><span class="header-section-number">22</span> TF Activity inference analysis</a></li>
<li><a class="active" href="pseudotime-analysis.html"><span class="header-section-number">23</span> Pseudotime analysis</a></li>
<li><a class="" href="color-palettes.html"><span class="header-section-number">24</span> Color palettes</a></li>
<li><a class="" href="common-features-across-plots.html">Common features across plots</a></li>
<li><a class="" href="save-the-figures.html">Save the figures</a></li>
<li><a class="" href="citation.html">Citation</a></li>
<li><a class="" href="news.html">News</a></li>
<li><a class="" href="acknowledgements.html">Acknowledgements</a></li>
</ul>

        <div class="book-extra">
          <!-- Duplicated this entry to point to the package repo. -->
          <p class="mb-2"><a id="package-repo" href="https://github.com/enblacar/SCpubr">View package source <i class="fab fa-github"></i></a></p>
          <p><a id="book-repo" href="https://github.com/enblacar/SCpubr-book">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="pseudotime-analysis" class="section level1" number="23">
<h1>
<span class="header-section-number">23</span> Pseudotime analysis<a class="anchor" aria-label="anchor" href="#pseudotime-analysis"><i class="fas fa-link"></i></a>
</h1>
<div class="errorbox warning">
<p>Due to a discontinuation of <a href="https://cran.r-project.org/web/packages/Matrix.utils/index.html"><strong>Matrix.utils package</strong></a>, <strong>monocle3</strong> can not be installed and tested in a CI manner. Until this is resolved,
this function <strong>will not be available in any official and developmental-stable release</strong>.</p>
</div>
<p>Pseudotime analysis is, perhaps, one of the major analysis that can be carried out in SC data. It aims to depict a trajectory, a sort of order in which cells transition from A to B. What defines this process, and the starting and end point is <strong>heavily</strong> driven by the research question, the nature of the data and prior knowledge. While inferring this using data-driven approaches is possible, in <code>SCpubr</code> we will implement a prior-knowledge driven approach in a very specific use case.</p>
<p>For this, we will make use of <a href="https://cole-trapnell-lab.github.io/monocle3/">monocle3</a>. Out of the many uses of monocle3, we can infer a trajectory graph for the cells and, based on a list of marker genes, we can <strong>order</strong> the cells along this graph selecting either the cell with the highest or lowest enrichment score for the provided list of genes as starting point. For example:</p>
<p><em>In a general sense, we are working with a data set for which a given biological phenotype is expected. For this phenotype, we do have a list of genes that accurately characterize this process. The process needs to be of a differentiation kind, meaning that cells will transition based on this list of genes between state A and state B. Once these conditions are met, we can make use of the trajectory graph alongside enrichment scores for the cells in the list of genes. Depending whether this list of genes depict the start of the end of the process, we can use the cell with the highest or lowest enrichment scores as the starting point of the differentiation trajectory, ordering the rest of the cells based on that and computing the associated pseudotime.</em></p>
<p>Of course, selecting the one cell with the highest or lowest enrichment scores might be a <em>simplistic</em> approach, as this elevated or low enrichment score might be due to technical bias. In order to correct this a bit, we first select the cluster (or selected group) that, in average, has the highest or lowest mean enrichment score and from this cluster we select the cell with the highest or lowest score, accordingly.</p>
<p>Having this clear, again, we would like to remark that this is a very specific use case of this analysis and much more can be done using monocle3. Please have a look at their <a href="https://cole-trapnell-lab.github.io/monocle3/docs/trajectories/">vignette</a> for more information about pseudotime analysis. For our specific use case, <code>SCpubr::do_PseudotimePlot()</code> can be used.</p>
<div id="setting-up-partitions-and-clusters" class="section level2" number="23.1">
<h2>
<span class="header-section-number">23.1</span> Setting up partitions and clusters<a class="anchor" aria-label="anchor" href="#setting-up-partitions-and-clusters"><i class="fas fa-link"></i></a>
</h2>
<p>For this function to work, we need a Seurat object together with a Cell Data Set (CDS) object, that needs to be generated by <code><a href="https://rdrr.io/pkg/SeuratWrappers/man/as.cell_data_set.html">SeuratWrappers::as.cell_data_set()</a></code>.</p>
<p>First thing to take into account is that monocle3 computes <em>partitions</em> and <em>clusters</em>. This is, when cells are too far away, the trajectory is disconnected, generating partitions with different start and end trajectories. We can tweak this process by forcing all of our data to be in a single partition or to keep as identities the group that we desire. This can be done by using <code>compute_monocle_partitions</code> and <code>compute_monocle_clusters</code> parameters.</p>
<p>We will use the following genes as a example, that depict CD14+ mono cells.</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Genes to use.</span></span>
<span><span class="va">pseudotime_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CD14"</span>, <span class="st">"LYN"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define your sample.</span></span>
<span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="va">your_seurat_object</span></span>
<span><span class="co"># Transform into CDS.</span></span>
<span><span class="va">cds</span> <span class="op">&lt;-</span> <span class="fu">SeuratWrappers</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SeuratWrappers/man/as.cell_data_set.html">as.cell_data_set</a></span><span class="op">(</span><span class="va">sample</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute monocle clusters and partitions.</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute monocle clusters and keep a single partition.</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute monocle partitions but keep original identities as clusters.</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Keep original identities as clusters and a single partition.</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set a metadata varible as clusters and a single partition.</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 group.by <span class="op">=</span> <span class="st">"orig.ident"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="visualizing-the-trajectory-graph" class="section level2" number="23.2">
<h2>
<span class="header-section-number">23.2</span> Visualizing the trajectory graph<a class="anchor" aria-label="anchor" href="#visualizing-the-trajectory-graph"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute trajectory graph.</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span><span class="op">)</span></span>
<span><span class="co"># Retrieve trajectory groups.</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">trajectory_groups</span></span>
<span><span class="co"># Retrieve trajectory partitions.</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">trajectory_partitions</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">|</span> <span class="va">p2</span></span>
<span><span class="va">p</span></span></code></pre></div>
<span class="border-0"><img src="images/example_pseudo1.png" class="mx-auto d-block" alt="" style="box-shadow: none; width: 100%"><p class="caption">
SCpubr do_PseudotimePlot trajectory graph output.
</p>
<p></p></span>
<p>We can increase the trajectory graph width by using <code>trajectory_graph_segment_size</code> and the color with <code>trajectory_graph_color</code> parameters.</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Change trajectory graph width.</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span>,</span>
<span>                                 trajectory_graph_segment_size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">trajectory_partitions</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span>,</span>
<span>                                 trajectory_graph_segment_size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">trajectory_partitions</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span>,</span>
<span>                                 trajectory_graph_segment_size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">trajectory_partitions</span></span>
<span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span>,</span>
<span>                                 trajectory_graph_segment_size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                 trajectory_graph_color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">trajectory_partitions</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">p1</span> <span class="op">|</span> <span class="va">p2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p3</span> <span class="op">|</span> <span class="va">p4</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<span class="border-0"><img src="images/example_pseudo1.png" class="mx-auto d-block" alt="" style="box-shadow: none; width: 100%"><p class="caption">
SCpubr do_PseudotimePlot trajectory graph with different widths and color.
</p>
<p></p></span>
We can also add different elements to the graph, such as the roots, branches and leaves with
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add nodes, branches and leaves to the trajectory graph.</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span>,</span>
<span>                                 trajectory_graph_segment_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                 label_roots <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">trajectory_partitions</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span>,</span>
<span>                                 trajectory_graph_segment_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                 label_roots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 label_branches <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">trajectory_partitions</span></span>
<span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span>,</span>
<span>                                 trajectory_graph_segment_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                 label_roots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 label_branches <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 label_leaves <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">trajectory_partitions</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span> <span class="op">/</span> <span class="va">p3</span></span>
<span><span class="va">p</span></span></code></pre></div>
<span class="border-0"><img src="images/example_pseudo3.png" class="mx-auto d-block" alt="" style="box-shadow: none; width: 100%"><p class="caption">
SCpubr do_PseudotimePlot trajectory graph with roots, branches and leaves.
</p>
<p></p></span>
## Visualizing the pseudotime
<p>We can inspect the pseudotime by providing whether the root of the trajectory is the highest or lowest enrichment score, with <code>is_max_score_the_start</code> parameter.</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot pseudotime with monocle partitions using highest score as root.</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span>,</span>
<span>                                 is_max_score_the_start <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">pseudotime</span></span>
<span></span>
<span><span class="co"># Plot pseudotime with monocle partitions using lowest score as root.</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span>,</span>
<span>                                 is_max_score_the_start <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">pseudotime</span></span>
<span></span>
<span></span>
<span><span class="co"># Plot pseudotime with monocle partitions using highest score as root.</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span>,</span>
<span>                                 is_max_score_the_start <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">pseudotime</span></span>
<span></span>
<span><span class="co"># Plot pseudotime with monocle partitions using lowest score as root.</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span>,</span>
<span>                                 is_max_score_the_start <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">pseudotime</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">p1</span> <span class="op">|</span> <span class="va">p2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p3</span> <span class="op">|</span> <span class="va">p4</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<span class="border-0"><img src="images/example_pseudo4.png" class="mx-auto d-block" alt="" style="box-shadow: none; width: 100%"><p class="caption">
SCpubr do_PseudotimePlot pseudotime output with different ordering.
</p>
<p></p></span>
As can be observed, if we compute different partitions, the one used will be the one that contains the highest or lowest enrichment score, up to our choice. If not, the whole trajectory for the whole UMAP will be used, providing very different results. The key to this is the kind of sample/cds we provide as input (i.e, if we have a tumor bulk that we want to keep as a single partition or not or similar).
<p>We can also visualize the enrichment scores as a feature plot alongside the pseudotime, either in a symmetrical scale or not with <code>enforce_symmetry</code>.</p>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot pseudotime with monocle partitions using highest score as root.</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span>,</span>
<span>                                 enforce_symmetry <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 is_max_score_the_start <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">pseudotime</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">enrichment</span></span>
<span><span class="co"># Plot pseudotime with monocle partitions using lowest score as root.</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu">do_PseudotimePlot</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                                 cds <span class="op">=</span> <span class="va">cds</span>,</span>
<span>                                 compute_monocle_partitions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 compute_monocle_clusters <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 pseudotime_genes <span class="op">=</span> <span class="va">pseudotime_genes</span>,</span>
<span>                                 enforce_symmetry <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 is_max_score_the_start <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">pseudotime</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">enrichment</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">p1</span> <span class="op">|</span> <span class="va">p2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p3</span> <span class="op">|</span> <span class="va">p4</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<span class="border-0"><img src="images/example_pseudo5.png" class="mx-auto d-block" alt="" style="box-shadow: none; width: 100%"><p class="caption">
SCpubr do_PseudotimePlot pseudotime output with enrichment scores.
</p>
<p></p></span>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="tf-activity-inference-analysis.html"><span class="header-section-number">22</span> TF Activity inference analysis</a></div>
<div class="next"><a href="color-palettes.html"><span class="header-section-number">24</span> Color palettes</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><form role="search" class="mt-4 mb-4">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>
      <div class="book-extra">
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#pseudotime-analysis"><span class="header-section-number">23</span> Pseudotime analysis</a></li>
<li><a class="nav-link" href="#setting-up-partitions-and-clusters"><span class="header-section-number">23.1</span> Setting up partitions and clusters</a></li>
<li><a class="nav-link" href="#visualizing-the-trajectory-graph"><span class="header-section-number">23.2</span> Visualizing the trajectory graph</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<!-- Modified page for chapter. --><li><a id="book-source" href="https://github.com/enblacar/SCpubr-book/blob/main/25-PseudotimeAnalysisPlots.Rmd">View chapter source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/enblacar/SCpubr-book/edit/main/25-PseudotimeAnalysisPlots.Rmd">Edit this chapter <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    
  </div>

</nav>
</div>
</div> <!-- .container -->




</div>
</body>
<!-- Moved the footer outside of the body to make it span all page width. --><footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p class="text-center">Written by <strong>Enrique Blanco Carmona</strong> on 14 October, 2022.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p class="text-center">This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</html>
