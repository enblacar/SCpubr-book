<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>11 Sankey and alluvial plots | SCpubr</title>
<meta name="author" content="Enrique Blanco Carmona">
<meta name="description" content="Due to CRAN policies, this function could not make it to the official release and is only available in the development release of SCpubr. Find how to install it here. Once the package becomes...">
<meta name="generator" content="bookdown 0.28 with bs4_book()">
<meta property="og:title" content="11 Sankey and alluvial plots | SCpubr">
<meta property="og:type" content="book">
<meta property="og:url" content="https://enblacar.github.io/SCpubr-book/sankey-and-alluvial-plots.html">
<meta property="og:image" content="https://enblacar.github.io/SCpubr-book/images/logo.png">
<meta property="og:description" content="Due to CRAN policies, this function could not make it to the official release and is only available in the development release of SCpubr. Find how to install it here. Once the package becomes...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="11 Sankey and alluvial plots | SCpubr">
<meta name="twitter:description" content="Due to CRAN policies, this function could not make it to the official release and is only available in the development release of SCpubr. Find how to install it here. Once the package becomes...">
<meta name="twitter:image" content="https://enblacar.github.io/SCpubr-book/images/logo.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link rel="shortcut icon" href="images/SCpubr_logo_favicon.png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a id="toc_title" href="index.html" title="">SCpubr</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <div class="book-extra"></div>
      <nav id="left-panel" aria-label="Table of contents"><ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About this package</a></li>
<li><a class="" href="installation-guide.html">Installation guide</a></li>
<li><a class="" href="dataset-used.html">Dataset used</a></li>
<li><a class="" href="dim-plots.html"><span class="header-section-number">1</span> Dim plots</a></li>
<li><a class="" href="feature-plots.html"><span class="header-section-number">2</span> Feature plots</a></li>
<li><a class="" href="nebulosa-plots.html"><span class="header-section-number">3</span> Nebulosa plots</a></li>
<li><a class="" href="bee-swarm-plots.html"><span class="header-section-number">4</span> Bee Swarm plots</a></li>
<li><a class="" href="violin-plots.html"><span class="header-section-number">5</span> Violin plots</a></li>
<li><a class="" href="ridge-plots.html"><span class="header-section-number">6</span> Ridge plots</a></li>
<li><a class="" href="dot-plots.html"><span class="header-section-number">7</span> Dot plots</a></li>
<li><a class="" href="bar-plots.html"><span class="header-section-number">8</span> Bar plots</a></li>
<li><a class="" href="box-plots.html"><span class="header-section-number">9</span> Box plots</a></li>
<li><a class="" href="geyser-plots.html"><span class="header-section-number">10</span> Geyser plots</a></li>
<li><a class="active" href="sankey-and-alluvial-plots.html"><span class="header-section-number">11</span> Sankey and alluvial plots</a></li>
<li><a class="" href="chord-diagram-plots.html"><span class="header-section-number">12</span> Chord Diagram plots</a></li>
<li><a class="" href="volcano-plots.html"><span class="header-section-number">13</span> Volcano plots</a></li>
<li><a class="" href="group-wise-de-analysis-plots.html"><span class="header-section-number">14</span> Group-wise DE analysis plots</a></li>
<li><a class="" href="term-enrichment-plots.html"><span class="header-section-number">15</span> Term Enrichment Plots</a></li>
<li><a class="" href="enrichment-score-heatmaps.html"><span class="header-section-number">16</span> Enrichment score heatmaps</a></li>
<li><a class="" href="correlation-matrix-heatmaps.html"><span class="header-section-number">17</span> Correlation matrix heatmaps</a></li>
<li><a class="" href="cellular-state-plots.html"><span class="header-section-number">18</span> Cellular State Plots</a></li>
<li><a class="" href="ligand-receptor-analysis.html"><span class="header-section-number">19</span> Ligand-Receptor analysis</a></li>
<li><a class="" href="copy-number-variant-analysis-plots.html"><span class="header-section-number">20</span> Copy Number Variant analysis plots</a></li>
<li><a class="" href="pathway-activity-inference-analysis.html"><span class="header-section-number">21</span> Pathway Activity inference analysis</a></li>
<li><a class="" href="tf-activity-inference-analysis.html"><span class="header-section-number">22</span> TF Activity inference analysis</a></li>
<li><a class="" href="pseudotime-analysis.html"><span class="header-section-number">23</span> Pseudotime analysis</a></li>
<li><a class="" href="color-palettes.html"><span class="header-section-number">24</span> Color palettes</a></li>
<li><a class="" href="common-features-across-plots.html">Common features across plots</a></li>
<li><a class="" href="save-the-figures.html">Save the figures</a></li>
<li><a class="" href="citation.html">Citation</a></li>
<li><a class="" href="news.html">News</a></li>
<li><a class="" href="acknowledgements.html">Acknowledgements</a></li>
</ul>

        <div class="book-extra">
          <!-- Duplicated this entry to point to the package repo. -->
          <p class="mb-2"><a id="package-repo" href="https://github.com/enblacar/SCpubr">View package source <i class="fab fa-github"></i></a></p>
          <p><a id="book-repo" href="https://github.com/enblacar/SCpubr-book">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="sankey-and-alluvial-plots" class="section level1" number="11">
<h1>
<span class="header-section-number">11</span> Sankey and alluvial plots<a class="anchor" aria-label="anchor" href="#sankey-and-alluvial-plots"><i class="fas fa-link"></i></a>
</h1>
<div class="warningbox warning">
<p>Due to CRAN policies, this function could not make it to the <strong>official release</strong> and is only available in the <strong>development release</strong> of <strong>SCpubr</strong>.
Find how to install it <a href="https://github.com/enblacar/SCpubr/releases/tag/v1.0.1-dev-stable"><strong>here</strong></a>.</p>
<p>Once the package becomes available on CRAN/Bioconductor, the function will be integrated in the official release.</p>
<p>Work in progress is being made to bring these plots back to the official release using another package. Stay tuned for the news!</p>
</div>
<p>Sankey and alluvial plots are a set of visualizations that help depicting how the cells “flow” from a given group to another. This can be particular interesting, let’s say, when we have a merged dataset that has samples from different subtypes and we want to see how the cells from each subtype distribute along the different clusters in our sample. Or, similarly, how the cells from each cluster distribute across the different individual datasets.</p>
<div id="basic-usage-9" class="section level2" number="11.1">
<h2>
<span class="header-section-number">11.1</span> Basic usage<a class="anchor" aria-label="anchor" href="#basic-usage-9"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Due to an internal bug in ggsankey, the package dplyr has to be loaded with <code><a href="https://dplyr.tidyverse.org">library(dplyr)</a></code> before running this function.</strong></p>
<p>This is how we can achieve basic Sankey or alluvial plots (using package):</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a more fine-grained clustering.</span></span>
<span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/FindSubCluster.html">FindSubCluster</a></span><span class="op">(</span><span class="va">sample</span>, cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"5"</span><span class="op">)</span>, graph.name <span class="op">=</span> <span class="st">"SCT_snn"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of nodes: 4428</span></span>
<span><span class="co">#&gt; Number of edges: 146366</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Running Louvain algorithm...</span></span>
<span><span class="co">#&gt; Maximum modularity in 10 random starts: 0.7966</span></span>
<span><span class="co">#&gt; Number of communities: 6</span></span>
<span><span class="co">#&gt; Elapsed time: 0 seconds</span></span>
<span><span class="va">sample</span><span class="op">$</span><span class="va">sub.cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"sub_"</span>, <span class="va">sample</span><span class="op">$</span><span class="va">sub.cluster</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute basic sankey plot.</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_SankeyPlot.html">do_SankeyPlot</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                            first_group <span class="op">=</span> <span class="st">"sub.cluster"</span>,</span>
<span>                            last_group <span class="op">=</span> <span class="st">"seurat_clusters"</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">"sankey"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute basic alluvial plot.</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_SankeyPlot.html">do_SankeyPlot</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                            first_group <span class="op">=</span> <span class="st">"sub.cluster"</span>,</span>
<span>                            last_group <span class="op">=</span> <span class="st">"seurat_clusters"</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">"alluvial"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-2"></span>
<img src="13-SankeyPlots_files/figure-html/unnamed-chunk-2-1.png" alt="Basic Sankey and Alluvial plots." width="100%" height="100%"><p class="caption">
Figure 1.1: Basic Sankey and Alluvial plots.
</p>
</div>
<p>The key aspects of this figure is that one has to provide the starting and end groups to <code>first_group</code> and <code>last_group</code> parameters, and the type of plot to <code>type</code>, making it either alluvial or sankey. The major difference between both is simply that the alluvial plot has not space between the groups. This allows for a more compact visualization, although it can get quite messy depending on the colors. We can keep adding as many groups as we want in between by using <code>middle_groups</code> parameter.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample</span><span class="op">$</span><span class="va">assignment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">sample</span><span class="op">$</span><span class="va">seurat_clusters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"2"</span>, <span class="st">"4"</span><span class="op">)</span>, <span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add more groups.</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_SankeyPlot.html">do_SankeyPlot</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                            first_group <span class="op">=</span> <span class="st">"sub.cluster"</span>,</span>
<span>                            middle_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seurat_clusters"</span>, <span class="st">"assignment"</span><span class="op">)</span>,</span>
<span>                            last_group <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">"sankey"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_SankeyPlot.html">do_SankeyPlot</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                            first_group <span class="op">=</span> <span class="st">"sub.cluster"</span>,</span>
<span>                            middle_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seurat_clusters"</span>, <span class="st">"assignment"</span><span class="op">)</span>,</span>
<span>                            last_group <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">"alluvial"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-3"></span>
<img src="13-SankeyPlots_files/figure-html/unnamed-chunk-3-1.png" alt="Basic Sankey and Alluvial plots with more groups." width="100%" height="100%"><p class="caption">
Figure 1.2: Basic Sankey and Alluvial plots with more groups.
</p>
</div>
</div>
<div id="modify-node-aesthetics" class="section level2" number="11.2">
<h2>
<span class="header-section-number">11.2</span> Modify node aesthetics<a class="anchor" aria-label="anchor" href="#modify-node-aesthetics"><i class="fas fa-link"></i></a>
</h2>
<p>By default, the color of the nodes and the fill is white, so that they can not be seen. One Can modify this by using <code>node.fill</code> and <code>node.color</code>.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Control the color and fill of the nodes.</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_SankeyPlot.html">do_SankeyPlot</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                            first_group <span class="op">=</span> <span class="st">"sub.cluster"</span>,</span>
<span>                            middle_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seurat_clusters"</span>, <span class="st">"assignment"</span><span class="op">)</span>,</span>
<span>                            last_group <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">"sankey"</span>,</span>
<span>                            node.fill <span class="op">=</span> <span class="st">"grey95"</span>,</span>
<span>                            node.color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_SankeyPlot.html">do_SankeyPlot</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                            first_group <span class="op">=</span> <span class="st">"sub.cluster"</span>,</span>
<span>                            middle_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seurat_clusters"</span>, <span class="st">"assignment"</span><span class="op">)</span>,</span>
<span>                            last_group <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">"alluvial"</span>,</span>
<span>                            node.fill <span class="op">=</span> <span class="st">"grey95"</span>,</span>
<span>                            node.color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-4"></span>
<img src="13-SankeyPlots_files/figure-html/unnamed-chunk-4-1.png" alt="Basic Sankey and Alluvial plots with modified colors for the nodes." width="100%" height="100%"><p class="caption">
Figure 1.3: Basic Sankey and Alluvial plots with modified colors for the nodes.
</p>
</div>
<p>As can be seen, the text labels, then, overlap the limits of the nodes. We can fix that using the <code>width</code> parameter:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Control the width of the nodes.</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_SankeyPlot.html">do_SankeyPlot</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                            first_group <span class="op">=</span> <span class="st">"sub.cluster"</span>,</span>
<span>                            middle_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seurat_clusters"</span>, <span class="st">"assignment"</span><span class="op">)</span>,</span>
<span>                            last_group <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">"sankey"</span>,</span>
<span>                            node.fill <span class="op">=</span> <span class="st">"grey95"</span>,</span>
<span>                            node.color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_SankeyPlot.html">do_SankeyPlot</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                            first_group <span class="op">=</span> <span class="st">"sub.cluster"</span>,</span>
<span>                            middle_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seurat_clusters"</span>, <span class="st">"assignment"</span><span class="op">)</span>,</span>
<span>                            last_group <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">"sankey"</span>,</span>
<span>                            node.fill <span class="op">=</span> <span class="st">"grey95"</span>,</span>
<span>                            node.color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>                            width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-5"></span>
<img src="13-SankeyPlots_files/figure-html/unnamed-chunk-5-1.png" alt="Basic Sankey and Alluvial plots with modified width of the nodes." width="100%" height="100%"><p class="caption">
Figure 1.4: Basic Sankey and Alluvial plots with modified width of the nodes.
</p>
</div>
</div>
<div id="control-alignment-of-the-labels" class="section level2" number="11.3">
<h2>
<span class="header-section-number">11.3</span> Control alignment of the labels<a class="anchor" aria-label="anchor" href="#control-alignment-of-the-labels"><i class="fas fa-link"></i></a>
</h2>
<p>We can also control the alignment of the labels (goes different by the different groups by default) using the <code>hjust</code> parameter. This will modify it for all the nodes.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Control the alignment of the labels.</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_SankeyPlot.html">do_SankeyPlot</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                            first_group <span class="op">=</span> <span class="st">"sub.cluster"</span>,</span>
<span>                            middle_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seurat_clusters"</span>, <span class="st">"assignment"</span><span class="op">)</span>,</span>
<span>                            last_group <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">"sankey"</span>,</span>
<span>                            node.fill <span class="op">=</span> <span class="st">"grey95"</span>,</span>
<span>                            node.color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>                            width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_SankeyPlot.html">do_SankeyPlot</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                            first_group <span class="op">=</span> <span class="st">"sub.cluster"</span>,</span>
<span>                            middle_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seurat_clusters"</span>, <span class="st">"assignment"</span><span class="op">)</span>,</span>
<span>                            last_group <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">"sankey"</span>,</span>
<span>                            node.fill <span class="op">=</span> <span class="st">"grey95"</span>,</span>
<span>                            node.color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>                            width <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                            hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-6"></span>
<img src="13-SankeyPlots_files/figure-html/unnamed-chunk-6-1.png" alt="Basic Sankey and Alluvial plots with modified label alignment." width="100%" height="100%"><p class="caption">
Figure 1.5: Basic Sankey and Alluvial plots with modified label alignment.
</p>
</div>
<p>We can also turn the text into labels, which will then be colored based on the end nodes. We can toggle it by using <code>use_labels = TRUE</code>.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use text or labels for the nodes.</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_SankeyPlot.html">do_SankeyPlot</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                            first_group <span class="op">=</span> <span class="st">"sub.cluster"</span>,</span>
<span>                            middle_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seurat_clusters"</span>, <span class="st">"assignment"</span><span class="op">)</span>,</span>
<span>                            last_group <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">"sankey"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_SankeyPlot.html">do_SankeyPlot</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                            first_group <span class="op">=</span> <span class="st">"sub.cluster"</span>,</span>
<span>                            middle_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seurat_clusters"</span>, <span class="st">"assignment"</span><span class="op">)</span>,</span>
<span>                            last_group <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">"sankey"</span>,</span>
<span>                            use_labels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            text_color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-7"></span>
<img src="13-SankeyPlots_files/figure-html/unnamed-chunk-7-1.png" alt="Sankey plots with texts and labels." width="100%" height="100%"><p class="caption">
Figure 1.6: Sankey plots with texts and labels.
</p>
</div>
</div>
<div id="increase-the-gap-between-the-nodes" class="section level2" number="11.4">
<h2>
<span class="header-section-number">11.4</span> Increase the gap between the nodes<a class="anchor" aria-label="anchor" href="#increase-the-gap-between-the-nodes"><i class="fas fa-link"></i></a>
</h2>
<p>One can also increase the gaps between the nodes. This is done by providing a number to <code>space</code>. This number would act as “invisible” cells in between the nodes. So one needs to think in terms of how many cells do we have in our dataset. The bigger the dataset, the higher the number we need to notice a difference. It is set by default to 5% of the total number of cells in the dataset.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Modify the space between nodes.</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_SankeyPlot.html">do_SankeyPlot</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                            first_group <span class="op">=</span> <span class="st">"sub.cluster"</span>,</span>
<span>                            middle_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seurat_clusters"</span>, <span class="st">"assignment"</span><span class="op">)</span>,</span>
<span>                            last_group <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">"sankey"</span>,</span>
<span>                            space <span class="op">=</span>  <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_SankeyPlot.html">do_SankeyPlot</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                            first_group <span class="op">=</span> <span class="st">"sub.cluster"</span>,</span>
<span>                            middle_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seurat_clusters"</span>, <span class="st">"assignment"</span><span class="op">)</span>,</span>
<span>                            last_group <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>                            type <span class="op">=</span> <span class="st">"sankey"</span>,</span>
<span>                            space <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-8"></span>
<img src="13-SankeyPlots_files/figure-html/unnamed-chunk-8-1.png" alt="Sankey plots with modified spaces between the nodes." width="100%" height="100%"><p class="caption">
Figure 1.7: Sankey plots with modified spaces between the nodes.
</p>
</div>
</div>
<div id="modify-default-colors" class="section level2" number="11.5">
<h2>
<span class="header-section-number">11.5</span> Modify default colors<a class="anchor" aria-label="anchor" href="#modify-default-colors"><i class="fas fa-link"></i></a>
</h2>
<p>Finally, we can modify the default colors by providing our own to <code>colors.first</code>, <code>colors.middle</code> and <code>colors.last</code>. It has to be a named vector with</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Modify default colors.</span></span>
<span><span class="va">colors.first</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_ColorPalette.html">do_ColorPalette</a></span><span class="op">(</span>colors.use <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>                                        n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">sample</span><span class="op">$</span><span class="va">sub.cluster</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">colors.first</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">sample</span><span class="op">$</span><span class="va">sub.cluster</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">SCpubr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SCpubr/man/do_SankeyPlot.html">do_SankeyPlot</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">sample</span>,</span>
<span>                           first_group <span class="op">=</span> <span class="st">"sub.cluster"</span>,</span>
<span>                           middle_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seurat_clusters"</span>, <span class="st">"assignment"</span><span class="op">)</span>,</span>
<span>                           last_group <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>                           type <span class="op">=</span> <span class="st">"sankey"</span>,</span>
<span>                           colors.first <span class="op">=</span> <span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-9"></span>
<img src="13-SankeyPlots_files/figure-html/unnamed-chunk-9-1.png" alt="Sankey plots with modified default colors." width="100%" height="100%"><p class="caption">
Figure 1.8: Sankey plots with modified default colors.
</p>
</div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="geyser-plots.html"><span class="header-section-number">10</span> Geyser plots</a></div>
<div class="next"><a href="chord-diagram-plots.html"><span class="header-section-number">12</span> Chord Diagram plots</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><form role="search" class="mt-4 mb-4">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>
      <div class="book-extra">
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#sankey-and-alluvial-plots"><span class="header-section-number">11</span> Sankey and alluvial plots</a></li>
<li><a class="nav-link" href="#basic-usage-9"><span class="header-section-number">11.1</span> Basic usage</a></li>
<li><a class="nav-link" href="#modify-node-aesthetics"><span class="header-section-number">11.2</span> Modify node aesthetics</a></li>
<li><a class="nav-link" href="#control-alignment-of-the-labels"><span class="header-section-number">11.3</span> Control alignment of the labels</a></li>
<li><a class="nav-link" href="#increase-the-gap-between-the-nodes"><span class="header-section-number">11.4</span> Increase the gap between the nodes</a></li>
<li><a class="nav-link" href="#modify-default-colors"><span class="header-section-number">11.5</span> Modify default colors</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<!-- Modified page for chapter. --><li><a id="book-source" href="https://github.com/enblacar/SCpubr-book/blob/main/13-SankeyPlots.Rmd">View chapter source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/enblacar/SCpubr-book/edit/main/13-SankeyPlots.Rmd">Edit this chapter <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    
  </div>

</nav>
</div>
</div> <!-- .container -->




</div>
</body>
<!-- Moved the footer outside of the body to make it span all page width. --><footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p class="text-center">Written by <strong>Enrique Blanco Carmona</strong> on 17 October, 2022.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p class="text-center">This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</html>
