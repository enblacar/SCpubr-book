# Dim plots

DimPlots are, probably, one of the most iconic visualizations from `Seurat`. It allows the user to visualize the cells in a dimensional reduction embedding such as `PCA` or `UMAP`. The cells can be, then, colored by any desired groups. In short, this visualization allows the user to plot **any kind of categorical data** onto the cells in the dimensional reduction embedding. 

## Figure build-up
In this subsection, we will break down the several modifications that are applied to figures by `SCpubr`. First, let's plot a DimPlot. This is achieved by using `Seurat::DimPlot()` function:

```{r echo = F}
sample <- readRDS("/b06x-isilon/b06x-g/G703/eblanco/projects/test_SC_datasets/sc_dataset.rds")
```

```{r, fig.cap = "Default DimPlot.", fig.width=8, fig.height=7}
p <- Seurat::DimPlot(sample)
p
```

Overall, this is a pretty neat visualization, but there are quite some changes that one would like to implement. For instance, shuffling the cells so that there is no overlap of cells just due to the cluster names.

```{r, fig.cap = "DimPlot with the cells shuffled.", fig.width=8, fig.height=7}
p <- Seurat::DimPlot(sample, 
                     shuffle = T)
p
```

Furthermore, one would think about the *need* of the axes. If, by consensus, UMAPs are shown plotting the first UMAP component on the X axis and the second on the Y axis, then showing them becomes redundant, specially when one can not truly rely on the numbers shown by the scales. 

```{r, fig.cap = "DimPlot without axes.", fig.width=8, fig.height=7}
p <- Seurat::DimPlot(sample, 
                     shuffle = T) + 
     Seurat::NoAxes()
p
```

Right now, we can observe a couple of things. First, is that the dot size is rather small. Let's set it to 0.5.

```{r, fig.cap = "DimPlot with increased dot size.", fig.width=8, fig.height=7}
p <- Seurat::DimPlot(sample, 
                     shuffle = T, 
                     pt.size = 0.5) + 
     Seurat::NoAxes()
p
```

Still, the legend seems rather small. Let's increase it's font size and set it to bold so that it can better read.

```{r, fig.cap = "DimPlot with increased font size.", fig.width=8, fig.height=7}
p <- Seurat::DimPlot(sample, 
                     shuffle = T, 
                     pt.size = 0.5) + 
    Seurat::NoAxes() +
    ggplot2::theme(legend.text = ggplot2::element_text(size = 12, 
                                                       face = "bold"),
                   legend.title = ggplot2::element_text(size = 12, 
                                                        face = "bold"))
p
```

We would also like to add a title to our plot, to best describe it.

```{r, fig.cap = "DimPlot with title.", fig.width=8, fig.height=7}
p <- Seurat::DimPlot(sample, 
                     shuffle = T, 
                     pt.size = 0.5) + 
     Seurat::NoAxes() +
     ggplot2::ggtitle("My awesome SC dataset") +
     ggplot2::theme(legend.text = ggplot2::element_text(size = 12, 
                                                        face = "bold"),
                    legend.title = ggplot2::element_text(size = 12, 
                                                         face = "bold"))
p
```

And, naturally, we would like to increase the font size of the title and put it in bold and centered.

```{r, fig.cap = "DimPlot with bigger and bold title.", fig.width=8, fig.height=7}
p <- Seurat::DimPlot(sample, 
                     shuffle = T, 
                     pt.size = 0.5) + 
     Seurat::NoAxes() +
     ggplot2::ggtitle("My awesome SC dataset") +
     ggplot2::theme(plot.title = ggplot2::element_text(size = 16, 
                                                       face = "bold", 
                                                       hjust = 0.5),
                    legend.text = ggplot2::element_text(size = 12, 
                                                        face = "bold"),
                    legend.title = ggplot2::element_text(size = 12, 
                                                         face = "bold"))
p
```

Now, we would like to modify the color palette. This palette has too bright colors, and we want something more toned down.

```{r, fig.cap = "DimPlot with custom color scale.", fig.width=8, fig.height=7}
num_clusters <- length(unique(sample$seurat_clusters))
color_scale <- colortools::setColors("#457b9d", num_clusters)
names(color_scale) <- sort(unique(sample$seurat_clusters))

p <- Seurat::DimPlot(sample, 
                     shuffle = T, 
                     pt.size = 0.5, 
                     cols = color_scale) + 
     Seurat::NoAxes() +
     ggplot2::ggtitle("My awesome SC dataset") +
     ggplot2::theme(plot.title = ggplot2::element_text(size = 16, 
                                                       face = "bold", 
                                                       hjust = 0.5),
                    legend.text = ggplot2::element_text(size = 12, 
                                                        face = "bold"),
                    legend.title = ggplot2::element_text(size = 12, 
                                                         face = "bold"))
p
```

As of now, this plot looks much better and polished than the default counterpart. This, is the setting ground for `SCpubr::do_DimPlot()`. 

## Basic usage

This is the default output from `SCpubr::do_DimPlot()`. 

```{r, fig.cap = "SCpubr DimPlot.", fig.width=8, fig.height=7}
p <- SCpubr::do_DimPlot(sample = sample)
p
```

Even though axes are removed from UMAP reductions, the title for the axes is kept for any other reduction used. The same is applied for UMAP if the default dimension order is altered.

```{r, fig.cap = "SCpubr DimPlot with PCA embedding showing axes titles and UMAP changing default dimension component order.", fig.width=16, fig.height=7}
p1 <- SCpubr::do_DimPlot(sample = sample, 
                         plot.title = "My awesome SC data set",
                         reduction = "pca")
p2 <- SCpubr::do_DimPlot(sample = sample, 
                         plot.title = "My awesome SC data set",
                         dims = c(2, 1))
p1 | p2
```


We can add a title with the `plot.title` parameter.

```{r, fig.cap = "SCpubr DimPlot with title.", fig.width=8, fig.height=7}
p <- SCpubr::do_DimPlot(sample = sample, 
                        plot.title = "My awesome SC data set")
p
```

We can change the legend location and number of columns with `legend.position` and `legend.ncol`.

```{r, fig.cap = "SCpubr DimPlot with legend to the left.", fig.width=9, fig.height=7}
p <- SCpubr::do_DimPlot(sample = sample, 
                        plot.title = "My awesome SC data set", 
                        legend.position = "left", 
                        legend.ncol = 2)
p
```

## Using labels instead of a legend

In some cases, especially early on in the analysis where we do only have numbers as cluster names, we might want to remove the legend entirely, and instead plot labels on top of each cluster. This is achieved by using `label = TRUE`. This is how it looks in Seurat:

```{r, fig.cap = "Seurat DimPlot with labels on top of the clusters.", fig.width=8, fig.height=7}
p <- Seurat::DimPlot(sample, 
                     label = T)
p
```    

However, we can play further with other parameters of the function such as `label.color` and `label.box`. This is integrated by default in `SCpubr::do_DimPlot`. This is how it looks:

```{r, fig.cap = "Seurat DimPlot with labels on top of the clusters.", fig.width=7, fig.height=7}
p <- SCpubr::do_DimPlot(sample = sample, 
                        label = TRUE, 
                        legend = FALSE)
p
``` 
The labels present now bold text for further readability. 

## Modifying default colors
If wanted, we can also change the colors of the identities in the DimPlot based on a custom color scheme. For this, a **named vector** containing the names of the identities as names and the HEX codes as values has to be provided to `colors.use`: 

```{r, fig.cap = "SCpubr, modifying default colors in a DimPlot", fig.width=8, fig.height=7}
# Create a color scale for the unique values in seurat clusters.
colors <- c("0" = "#001219",
            "1" = "#005f73",
            "2" = "#0a9396",
            "3" = "#94d2bd",
            "4" = "#e9d8a6",
            "5" = "#ee9b00",
            "6" = "#ca6702",
            "7" = "#bb3e03",
            "8" = "#ae2012",
            "9" = "#9b2226")

p <- SCpubr::do_DimPlot(sample = sample, 
                        colors.use = colors)
p
```

## Highlighting cells

One of the nice features of `Seurat::DimPlot()` is the possibility of highlighting a certain group of cells in the DimPlot. This is achieved by using the `cells.highligh` parameter. This is how the default plot looks like.

```{r, fig.cap = "Seurat DimPlot highlighting cells.", fig.width=8, fig.height=7}
# Select 1000 random cells out of clusters 1, 5 and 7.
cells.use <- sample(colnames(sample[, sample$seurat_clusters %in% c("1", "5", "7")]), 1000)
p <- Seurat::DimPlot(sample, 
                     cells.highlight = cells.use)
p
```

To achieve a similar effect in `SCpubr::do_DimPlot()`, we can use the same parameter `cells.highlight`. Also, we can change the color of the highligted cells by providing single color to `colors.use`:

```{r, fig.cap = "SCpubr DimPlot highlighting cells.", fig.width=16, fig.height=7}
# Select 1000 random cells out of clusters 1, 5 and 7.
cells.use <- sample(colnames(sample[, sample$seurat_clusters %in% c("1", "5", "7")]), 1000)
p1 <- SCpubr::do_DimPlot(sample = sample, 
                         cells.highlight = cells.use)
p2 <- SCpubr::do_DimPlot(sample = sample, 
                         cells.highlight = cells.use,
                         colors.use = "steelblue")
p1 | p2
```

By default, the size of all cells in `SCpubr::do_DimPlot()` is the same. However, the size of the highlighted dots can be modified with the parameter `sizes.highlight` from Seurat.

```{r, fig.cap = "SCpubr DimPlot highlighting cells bigger dot size.", fig.width=8, fig.height=7}
# Select 1000 random cells out of clusters 1, 5 and 7.
cells.use <- sample(colnames(sample[, sample$seurat_clusters %in% c("1", "5", "7")]), 1000)
p <- SCpubr::do_DimPlot(sample = sample, 
                        cells.highlight = cells.use, 
                        sizes.highlight = 1)
p
```

## Splitting by a category

Another useful parameter of `Seurat::DimPlot` is `split.by`, which allows you to split your DimPlot into multiple panels, each one containing a different unique value of the metadata variable you have provided to the argument. One can understand this as using the `group.by` parameter and then splitting the resulting DimPlot into different panels. In this example, we are going to use the different clusters as an example This is how it looks by default:

```{r, fig.cap = "Seurat DimPlot using split.by.", fig.width=10, fig.height=5}
# Using ncol = 5 to maintain some of the proportions. 
p <- Seurat::DimPlot(sample, 
                     split.by = "seurat_clusters", 
                     ncol = 5)
p
```
As can be observed, this plots accomplish the task of separating the cells into each panel, but the approach followed actually makes interpretation difficult. Clusters such as Cluster 9, with fewer cells, tell pretty much nothing. Not knowing how the original UMAP looked like is a major downside of this approach. This is where `SCpubr` focus. Instead of using `Seurat`'s `split.by` parameter, it generates as many plots as unique values in the metadata to split the plot by, but uses `cells.highlight` instead, which keeps the rest of cells greyed out. This is how it looks:

```{r, fig.cap = "SCpubr DimPlot using split.by.", fig.width=25, fig.height=10}
# Using ncol = 5 to maintain some of the proportions.
# Using legend = F to remove unwanted repeated legends.
p <- SCpubr::do_DimPlot(sample, 
                        split.by = "seurat_clusters", 
                        ncol = 5, 
                        legend = F)
p
```

This way, we can see that clusters such as Cluster 7 are way more disperse than the rest, accounting not only for standalone groups of cells but also blending in other bigger clusters. Actually, the user might want to change the color of the highlighted cells in this split DimPlot. This is achieved by using `colors.use` parameter and providing either a vector of **valid color representations** of equal length to unique values in `split.by` or just a single color to color all panels the same.


```{r, fig.cap = "SCpubr DimPlot using split.by with a changed color", fig.width=25, fig.height=20}
# Create a color scale for the unique values in seurat clusters.
colors <- c("0" = "#001219",
            "1" = "#005f73",
            "2" = "#0a9396",
            "3" = "#94d2bd",
            "4" = "#e9d8a6",
            "5" = "#ee9b00",
            "6" = "#ca6702",
            "7" = "#bb3e03",
            "8" = "#ae2012",
            "9" = "#9b2226")

p1 <- SCpubr::do_DimPlot(sample, 
                         split.by = "seurat_clusters", 
                         ncol = 5, 
                         legend = F, 
                         colors.use = colors)

p2 <- SCpubr::do_DimPlot(sample, 
                         split.by = "seurat_clusters", 
                         ncol = 5, 
                         legend = F, 
                         colors.use = "#008080")
p1 / p2
```



